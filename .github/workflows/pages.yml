File: .github/workflows/pages.yml

name: Build and deploy to GitHub Pages
on:
push:
branches: [ "main" ]
workflow_dispatch:
schedule:
- cron: '0 */6 * * *'

permissions:
contents: read
pages: write
id-token: write

concurrency:
group: pages
cancel-in-progress: true

jobs:
build:
runs-on: ubuntu-latest
steps:
- name: Checkout
uses: actions/checkout@v4

  - name: Setup Node
    uses: actions/setup-node@v4
    with:
      node-version: 20

  - name: Fetch data from JSONBin
    run: node scripts/fetch-jsonbin.js
    env:
      BIN_ID: ${{ secrets.JSONBIN_BIN_ID }}
      JSONBIN_MASTER_KEY: ${{ secrets.JSONBIN_MASTER_KEY }}

  - name: Prepare Pages artifact
    run: |
      mkdir -p dist
      cp -R ./*.html dist/
      cp -R ./data dist/
      [ -f ./favii.png ] && cp ./favii.png dist/ || true

  - name: Upload artifact
    uses: actions/upload-pages-artifact@v3
    with:
      path: dist
deploy:
needs: build
runs-on: ubuntu-latest
environment:
name: github-pages
url: ${{ steps.deployment.outputs.page_url }}
steps:
- name: Deploy to GitHub Pages
id: deployment
uses: actions/deploy-pages@v4
